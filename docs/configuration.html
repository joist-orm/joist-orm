<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/configuration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Configuration | Joist</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://joist-orm.io/docs/configuration"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="TypeScript, ORM, Reactivity, Domain Driven Design, Unit of Work, ActiveRecord"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Configuration | Joist"><meta data-rh="true" name="description" content="Joist prefers convention over configuration, but it still has some knobs to control its behavior."><meta data-rh="true" property="og:description" content="Joist prefers convention over configuration, but it still has some knobs to control its behavior."><link data-rh="true" rel="canonical" href="https://joist-orm.io/docs/configuration"><link data-rh="true" rel="alternate" href="https://joist-orm.io/docs/configuration" hreflang="en"><link data-rh="true" rel="alternate" href="https://joist-orm.io/docs/configuration" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.37bfbcff.css">
<script src="/assets/js/runtime~main.e0e95bc5.js" defer="defer"></script>
<script src="/assets/js/main.0992c96b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Joist</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/goals">Goals</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/modeling/fields">Domain Modeling</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/features/entity-manager">Features</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/testing/test-factories">Testing</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/joist-orm/joist-orm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.youtube.com/@joist-orm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://discord.gg/ky9VTQugqu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_bzqh"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r"><div class="docsWrapper__sE8"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docRoot_DfVB"><aside class="theme-doc-sidebar-container docSidebarContainer_c7NB"><div class="sidebarViewport_KYo0"><div class="sidebar_CUen"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/getting-started/tour">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/tour">Quick Tour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/schema-assumptions">Schema Assumptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/configuration">Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/goals">Goals</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/modeling/fields">Domain Modeling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/features/entity-manager">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/advanced/unit-of-work">Advanced Features</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/testing/test-factories">Testing</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_a9sJ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_T5ub" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_sfvy"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configuration</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuration</h1></header><p>Joist prefers convention over configuration, but it still has some knobs to control its behavior.</p>
<p>The configuration is split into two sections:</p>
<ol>
<li>Codegen config, used by <code>npm run joist-codegen</code> during the code generation build step,</li>
<li>Runtime config, used by <code>EntityManager</code> at runtime to configure the database that Joist connects to.</li>
</ol>
<p>You can get started without any codegen config, and only some minimal runtime config.</p>
<h2 id="codegen-configuration">Codegen Configuration</h2>
<p>The codegen configuration is controlled by a <code>./joist-config.json</code> file, that <code>npm run joist-codegen</code> will look for and automatically run.</p>
<p>A short, minimalistic example is:</p>
<pre><code class="language-json">{
  &quot;entitiesDirectory&quot;: &quot;./src/entities&quot;
}
</code></pre>
<p>Each of the supported keys are described below. Note this is an exhaustive list, but all the keys are optional.</p>
<h3 id="databaseurl"><code>databaseUrl</code></h3>
<p>This is the <em>build-time</em> connection information for your database, e.g. it is only used when running <code>npm run joist-codegen</code>, and won&#x27;t be used for either your unit tests or production code, because it&#x27;s assumed to have a hard-coded/local-only host/port/etc.</p>
<p>If this is not set, <code>npm run joist-codegen</code> will also look for a <code>DATABASE_URL</code> environment variable.</p>
<h3 id="idtype"><code>idType</code></h3>
<p>Controls the type of the domain model&#x27;s <code>id</code> properties, i.e. <code>Author.id</code> or <code>author1.id</code>.</p>
<p>Available values: <code>tagged-string</code>, <code>untagged-string</code>, <code>number</code>.</p>
<p>Joist&#x27;s default behavior is <code>tagged-string</code> which means the type of <code>Author.id</code> will be a <code>string</code>, and the value will be <code>&quot;a:1&quot;</code> where <code>a</code> is the &quot;tag&quot; established for all <code>Author</code> entities, and <code>1</code> is the numeric primary key value of that row.</p>
<p>If you do not want the <code>a:</code> tagged prefix, you can use <code>untagged-string</code> or <code>number</code>:</p>
<pre><code class="language-json">{
  &quot;idType&quot;: &quot;untagged-string&quot;
}
</code></pre>
<p>This is currently a project-wide setting and cannot be changed on an entity-by-entity basis.</p>
<p>Also note that this <code>idType</code> setting controls the <em>codegen output</em>, but Joist will still look at the database type of each individual entity&#x27;s <code>id</code> column to determine if the SQL values are actually numbers (i.e. auto increment integers) or other types like UUIDs.</p>
<admonition type="info"><p>Even if you use <code>untagged-string</code>s, currently Joist still manages ids internally as tagged, and so you&#x27;ll still see a per-entity <code>tag</code> established in the <code>joist-config.json</code> file, but the tag will be stripped by the <code>id</code> getters.</p></admonition>
<h3 id="contexttype"><code>contextType</code></h3>
<p>This optional key specifies your application specific <code>Context</code> type, if you&#x27;re using that pattern.</p>
<p>The expectation is that this will be a request-level <code>Context</code>, i.e. it might hold user auth information or other application-specific information.</p>
<p>If you pass your request-level <code>Context</code> to each <code>EntityManager</code>:</p>
<pre><code class="language-ts">import { Context } from &quot;src/context&quot;;
import { EntityManager } from &quot;src/entities&quot;;

const em = new EntityManager(ctx, driver);
</code></pre>
<p>Then in <code>EntityManager</code>-managed hooks, you&#x27;ll be able to access the context:</p>
<pre><code class="language-ts">config.beforeDelete((book, ctx) =&gt; {
  if (!ctx.user.isAdmin) {
    return &quot;Only admins can delete a book&quot;;
  }
});
</code></pre>
<p>And the <code>ctx</code> param will be correctly typed to your application&#x27;s specific <code>Context</code> type.</p>
<h3 id="entitiesdirectory"><code>entitiesDirectory</code></h3>
<p>This controls whether Joist outputs the entity, codegen, and metadata files.</p>
<p>The default is <code>./src/entities</code>.</p>
<h3 id="createflushfunction"><code>createFlushFunction</code></h3>
<p>Joist&#x27;s preferred approach to testing is to let tests <code>COMMIT</code> their code, and then use a <code>flush_database</code> stored procedure to very quickly <code>TRUNCATE</code> all tables between each test.</p>
<p>This <code>flush_database</code> stored procedure if created during <code>npm run codegen</code>.</p>
<p>If you&#x27;d prefer to not use, you can set this to false:</p>
<pre><code class="language-json">{
  &quot;createFlushFunction&quot;: false
}
</code></pre>
<p>If you have multiple test databases (i.e. one per Jest work), you can set the parameter to an array of database names:</p>
<pre><code class="language-json">{
  &quot;createFlushFunction&quot;: [&quot;db_test_1&quot;, &quot;db_test_2&quot;]
}
</code></pre>
<h3 id="ignoredtables"><code>ignoredTables</code></h3>
<p>Allows ignoring tables, i.e. not generating TypeScript entities for them.</p>
<pre><code class="language-json">{
  &quot;ignoredTables&quot;: [&quot;some_old_thing&quot;]
}
</code></pre>
<h3 id="timestampcolumns"><code>timestampColumns</code></h3>
<p>Joist will automatically manage columns like <code>Author.created_at</code> and <code>Author.updated_at</code>.</p>
<p>The <code>timestampColumns</code> key lets you configure your schema&#x27;s conventions for column names.</p>
<p>For example the following config looks for <em>only</em> <code>updated_at</code> and <code>created_at</code> and requires both column to be present for Joist to consider a database table and entity table:</p>
<pre><code class="language-json">{
  &quot;timestampFields&quot;: {
    &quot;updatedAt&quot;: {
      &quot;names&quot;: [&quot;updated_at&quot;],
      &quot;required&quot;: true
    },
    &quot;createdAt&quot;: {
      &quot;names&quot;: [&quot;created_at&quot;],
      &quot;required&quot;: true
    },
    &quot;deletedAt&quot;: {
      &quot;names&quot;: [&quot;deleted_at&quot;],
      &quot;required&quot;: true
    }
  }
}
</code></pre>
<p>The default configuration is basically:</p>
<pre><code class="language-json">{
  &quot;timestampFields&quot;: {
    &quot;updatedAt&quot;: {
      &quot;names&quot;: [&quot;updated_at&quot;, &quot;updatedAt&quot;],
      &quot;required&quot;: false
    },
    &quot;createdAt&quot;: {
      &quot;names&quot;: [&quot;created_at&quot;, &quot;createdAt&quot;],
      &quot;required&quot;: false
    }
  }
}
</code></pre>
<p>I.e. Joist will look for either <code>updated_at</code> or <code>updatedAt</code> naming conventions, and will not require the <code>updatedAt</code> column be present to consider a table an entity table.</p>
<h3 id="codegenplugins"><code>codegenPlugins</code></h3>
<p>Allows other functionality to be inserted into the <code>npm run joist-codegen</code> pipeline.</p>
<p>The current example is an extra GraphQL-specific plugin that creates GraphQL-specific scaffolding/output based on your domain model:</p>
<pre><code class="language-json">{
  &quot;codegenPlugins&quot;: [&quot;joist-graphql-codegen&quot;]
}
</code></pre>
<h3 id="entities"><code>entities</code></h3>
<p>This is a big section that allows per-entity configuration.</p>
<p>There are several sub-keys:</p>
<pre><code class="language-typescript">export interface EntityConfig {
  tag: string;
  tableName?: string;
  fields?: Record&lt;string, FieldConfig&gt;;
  relations?: Record&lt;string, RelationConfig&gt;;
  orderBy?: string;
}
</code></pre>
<h4 id="tag"><code>tag</code></h4>
<p>This controls the tag that Joist uses for each entity. By default, Joist will guess a tag by abbreviating a table name <code>books_reviews</code> as the tag <code>br</code> and automatically save it in <code>joist-config.json</code>. If you&#x27;d like a different value, you&#x27;re free to change it.</p>
<pre><code class="language-json">{
  &quot;entities&quot;: {
    &quot;Author&quot;: { &quot;tag&quot;: &quot;a&quot; }
  }
}
</code></pre>
<p>Note that you should probably not change the tag name for an entity after it has been deployed to production, b/c the tagged id could exist in external systems, i.e. if you&#x27;ve sent <code>&quot;a:1&quot;</code> to a 3rd party system, and then change your tag to <code>&quot;author&quot;</code>, you might break an integration that tries to look up the entity by the old <code>&quot;a:1&quot;</code> value.</p>
<h4 id="tablename"><code>tableName</code></h4>
<p>Allows defining specific entity names for tables, for example if you had a <code>tbl_publishers</code> table that you wanted to back the <code>Publisher</code> entity, then you could setup:</p>
<pre><code class="language-json">{
  &quot;entities&quot;: {
    &quot;Publisher&quot;: { &quot;tableName&quot;: &quot;tbl_publishers&quot; }
  }
}
</code></pre>
<p>By default, Joist assumes table names are plural (i.e. <code>publishers</code>) and will <a href="https://www.npmjs.com/package/pluralize"><code>singular</code></a> the name for the entity name (i.e. <code>Publisher</code>).</p>
<h3 id="entitiesorderby"><code>entities.orderBy</code></h3>
<p>Allows defining a default <code>orderBy</code> for the entity, i.e. if you want to always order <code>Publisher</code> entities by <code>name</code> by default, you could setup:</p>
<pre><code class="language-json">{
  &quot;entities&quot;: {
    &quot;Publisher&quot;: { &quot;orderBy&quot;: &quot;name&quot; }
  }
}
</code></pre>
<p>The <code>orderBy</code> value must be the field name of a primitive, synchronous value on the entity. Or a field name with an <code>ASC</code> / <code>DESC</code> suffix, i.e. <code>&quot;orderBy&quot;: &quot;name DESC&quot;</code>.</p>
<p>If unset, Joist will order by <code>id</code> by default to ensure deterministic ordering.</p>
<h3 id="entitiesfields"><code>entities.fields</code></h3>
<p>You can configure primitive fields by setting the camel-cased field name in the entity&#x27;s <code>fields</code> key:</p>
<pre><code class="language-json">{
  &quot;entities&quot;: {
    &quot;Author&quot;: { &quot;fields&quot;: { &quot;firstName&quot;: {} } }
  }
}
</code></pre>
<p>Within the field literal, these values are supported:</p>
<pre><code class="language-ts">export interface FieldConfig {
  derived?: &quot;sync&quot; | &quot;async&quot;;
  protected?: boolean;
  ignore?: true;
  superstruct?: string;
  zodSchema?: string;
  type?: string;
}
</code></pre>
<p>Where:</p>
<ul>
<li>
<p><code>derived</code> controls whether this field is derived from business logic (...link to docs...)</p>
</li>
<li>
<p><code>protected</code> controls whether this is field is <code>protected</code> and so can only be accessed internally by the domain model code</p>
</li>
<li>
<p><code>ignore</code> controls whether to ignore the field</p>
</li>
<li>
<p><code>superstruct</code> links to the superstruct type to use for <a href="/docs/modeling/jsonb-fields"><code>jsonb</code> columns</a>, i.e. <code>commentStreamReads@src/entities/superstruct</code></p>
</li>
<li>
<p><code>zodSchema</code> links to the Zod schema to use for <a href="/docs/modeling/jsonb-fields"><code>jsonb</code> columns</a>, i.e. <code>CommentStreamReads@src/entities/schemas</code></p>
</li>
<li>
<p><code>type</code> links to an TypeScript type to use instead of the schema derived one</p>
<p>Currently, the <code>type</code> must be a <a href="https://typescript.tv/best-practices/improve-your-type-safety-with-branded-types/">branded type</a> of the runtime type, b/c Joist will still instantiate the value with whatever it&#x27;s schema-derived value is.</p>
<p>See <a href="https://github.com/joist-orm/joist-orm/discussions/674#discussioncomment-6092907">this discussion</a> for a future <code>serde</code> feature that would allow you to instantiate custom runtime values.</p>
</li>
</ul>
<h3 id="entitiesrelations"><code>entities.relations</code></h3>
<p>You can configure relations (references and collections to other entities) by setting the camel-cased relation name in the entity&#x27;s <code>relations</code> key:</p>
<pre><code class="language-typescript">export interface RelationConfig {
  polymorphic?: &quot;notNull&quot; | true;
  large?: true;
  orderBy?: string;
}
</code></pre>
<p>The supported values are:</p>
<ul>
<li><code>polymorphic</code> creates this relation as a <a href="/docs/modeling/relations#polymorphic-references">polymorphic relation</a>, which logical combines several physical foreign keys into a single field</li>
<li><code>large</code> indicates that a collection is too big to be fully loaded into memory and changes the generated type to <code>LargeCollection</code></li>
<li><code>orderBy</code> allows setting an order specific to this collection, the value must be a primitive, synchronous field on the entities within the collection</li>
</ul>
<h2 id="runtime-configuration">Runtime Configuration</h2>
<p>There are three main things to configure at runtime:</p>
<ul>
<li>Connection pool</li>
<li>Driver</li>
<li>EntityManager</li>
</ul>
<h3 id="connection-pool">Connection Pool</h3>
<p>Your application should have a single global connection pool; currently Joist recommends using <a href="http://knexjs.org/">knex</a>:</p>
<pre><code class="language-typescript">import { newPgConnectionConfig } from &quot;joist-utils&quot;;

const knex = createKnex({
  client: &quot;pg&quot;,
  // This will read DATABASE_URL, but you can use whatever config you want, see the knex docs
  connection: newPgConnectionConfig(),
  // Setting this is true will `console.log` the SQL statements that Joist executes
  debug: false,
  asyncStackTraces: true,
});
</code></pre>
<h3 id="driver">Driver</h3>
<p>Joist has a <code>Driver</code> interface to support multiple different databases, like Postgres or MySQL or even an experimental in-memory driver. Currently only Postgres is supported.</p>
<p>Similar to the knex connection pool, you can create a single global instance of this driver:</p>
<pre><code class="language-typescript">const driver = new PostgresDriver(knex);
</code></pre>
<h4 id="idassigner">IdAssigner</h4>
<p>When creating the <code>PostgresDriver</code>, you can pass an <code>IdAssigner</code> instance, which currently has three implementations:</p>
<ul>
<li><code>SequenceIdAssigner</code> assigns numeric ids from each entity&#x27;s <code>SEQUENCE</code></li>
<li><code>RandomUuidAssigner</code> assigns random UUIDs if you&#x27;re using UUID columns</li>
<li><code>TestUuidAssigner</code> assigns deterministic UUIDs for unit testing</li>
</ul>
<h3 id="entitymanager">EntityManager</h3>
<p>With the global connection pool and <code>Driver</code> instance, you can create per-request <code>EntityManager</code> instances:</p>
<pre><code class="language-typescript">// Your application&#x27;s per-request Context, if applicable
const ctx = {};
const em = new EntityManager(ctx, driver);
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/joist-orm/joist-orm/edit/main/docs/docs/getting-started/configuration.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_ydrU"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/schema-assumptions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Schema Assumptions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/goals"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#codegen-configuration" class="table-of-contents__link toc-highlight">Codegen Configuration</a><ul><li><a href="#databaseurl" class="table-of-contents__link toc-highlight"><code>databaseUrl</code></a></li><li><a href="#idtype" class="table-of-contents__link toc-highlight"><code>idType</code></a></li><li><a href="#contexttype" class="table-of-contents__link toc-highlight"><code>contextType</code></a></li><li><a href="#entitiesdirectory" class="table-of-contents__link toc-highlight"><code>entitiesDirectory</code></a></li><li><a href="#createflushfunction" class="table-of-contents__link toc-highlight"><code>createFlushFunction</code></a></li><li><a href="#ignoredtables" class="table-of-contents__link toc-highlight"><code>ignoredTables</code></a></li><li><a href="#timestampcolumns" class="table-of-contents__link toc-highlight"><code>timestampColumns</code></a></li><li><a href="#codegenplugins" class="table-of-contents__link toc-highlight"><code>codegenPlugins</code></a></li><li><a href="#entities" class="table-of-contents__link toc-highlight"><code>entities</code></a></li><li><a href="#entitiesorderby" class="table-of-contents__link toc-highlight"><code>entities.orderBy</code></a></li><li><a href="#entitiesfields" class="table-of-contents__link toc-highlight"><code>entities.fields</code></a></li><li><a href="#entitiesrelations" class="table-of-contents__link toc-highlight"><code>entities.relations</code></a></li></ul></li><li><a href="#runtime-configuration" class="table-of-contents__link toc-highlight">Runtime Configuration</a><ul><li><a href="#connection-pool" class="table-of-contents__link toc-highlight">Connection Pool</a></li><li><a href="#driver" class="table-of-contents__link toc-highlight">Driver</a></li><li><a href="#entitymanager" class="table-of-contents__link toc-highlight">EntityManager</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/goals">Goals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/joist-orm/joist-orm/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/ky9VTQugqu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024</div></div></div></footer></div>
</body>
</html>